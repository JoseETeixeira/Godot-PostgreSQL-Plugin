import os
import platform

env = Environment()

godot_cpp_path = "C:/Users/pc/Desktop/DragonBall2D/DragonOrbsUniverse2D/client/addons/postgresql_plugin/godot-cpp"
libpq_dir = "C:/Users/pc/Desktop/DragonBall2D/DragonOrbsUniverse2D/client/addons/postgresql_plugin"

include_paths = [
    godot_cpp_path + "/include",
    godot_cpp_path + "/include/godot_cpp",
    godot_cpp_path + "/include/core",
    godot_cpp_path + "/gen/include",
    godot_cpp_path + "/gdextension"
]

print("Include paths:", include_paths)

env.Append(CPPPATH=include_paths)

env.Append(LIBPATH=[
    libpq_dir
])

env.Append(LIBS=[
    "libpq"
])

# Set the compiler to use C++17
if env['PLATFORM'] == 'win32' or env['PLATFORM'] == 'win64':
    env.Append(CCFLAGS='/std:c++17')
else:
    env.Append(CCFLAGS='-std=c++17')

sources = Glob('src/*.cpp')
target = 'postgresql'

env.SharedLibrary(target=target, source=sources)
